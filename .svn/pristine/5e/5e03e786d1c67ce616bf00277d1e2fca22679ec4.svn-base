#ifndef PATH_H
#define PATH_H

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>
#include <limits.h>
#include <signal.h>
#include <unistd.h>
#include "util.h"
#include "deck.h"

#define Mo "Mo"
#define V1 "V1"
#define V2 "V2"
#define Do "Do"
#define Ri "Ri"
#define Barrier "::"
#define NUM_CARDS 5


/** Represents a collection of cards. **/
typedef enum Cards {
    // how many the player has collected
    A,
    B,
    C,
    D,
    E
} Cards;





/** Represents a player in the game. **/
typedef struct Player {
    // how much money the player has
    int money;

    // the player ID
    int ID;

    // which site the player is at
    int siteNumber;

    // how many times the player has visited the sites
    int countV1;
    int countV2;

    // the player's points
    int points;

    // the cards the player has collected
    int *cards;

    // the players position relative to the rest of the players
    // eg for 5 players, 0 means the player is in the front
    // 4 means the player is last so their move is next
    int position;

    // comms pipes
    int sendPipes[2];
    int receivePipes[2];

    // to communicate with players
    FILE *reader;
    FILE *writer;
} Player;

/** A single site.
 */
typedef struct Site {
    // type of site
    char *type;

    // max number of players the site can have
    int playerLimit;

    // array of playerIDs.
    int *playerIDs;

    // the number of players currently at the site
    int numPlayersCurrently;
} Site;

/** Represents the game path.
 */
typedef struct Path {
    // size of the path
    int size;

    // the number of players in the game
    int playersInGame;

    // array of sites on the path
    Site *sites;

    // array of player pointers
    Player **players;

    Deck *deck;
} Path;
int next_player_to_move(Path *path);
void sig_handler(int signal);
int find_next_barrier(Path *path, int currentSiteID);
int check_if_most_cards(Path *path, Player *player);
int check_empty_cards(Path *path);
int player_B_next_move(Path *path, int  playerID);
int check_input(char *line, Path *path, int playerID, char playerType);
int sum_cards(Player *player);
int player_A_next_move(Path *path, int playerID);
int check_if_last_player(Path *path, Player *player);
int get_input();
void game_over(Path *path, FILE *location);
int find_earliest(Path *path, int currentSiteID);
void start_player(int numPlayers, int ID, Path *path, char playerType);
char *handle_user_input();
int debug_helper(char *data);
void print_player_details(Path *path, int playerID, FILE *location);
int do_ri(Deck *deck, Player *player);
int do_action(Path *path, int playerID);
int get_highest_score(Path *path, int sideNum);
double calculate_position(int siteNum, int numPlayers);
void print_path(Path *path, FILE *file);
Path *allocate_path(char *line, int numPlayers);
int check_game_over(Path *path);
int calculate_total_score(Player *player);
Player *init_player(Path *path, int ID);
void move_player(Path *path, int playerID, int steps);
int available(Site site);
void arrange_order_of_players(Path *path);
int next_player_to_move(Path *path);
#endif